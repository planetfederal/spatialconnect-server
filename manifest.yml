# build steps
#############
# NOTE: run the following from the root of spatialconnect-server
#############
# pushd web && npm install && npm run build:devio && popd
# pushd server && lein uberjar && popd
# if ! cf s | grep 'efc-db-test'; then cf cs pg_95_XL_DEV_SHARED_001 large-dev-100 efc-db-test -c cf/efc-db.json; fi
# if ! cf S | grep 'efc-mqtt-test'; then cf cs p-rabbitmq standard efc-mqtt-test; fi
# cf push
#############
---
applications:
  - name: efc-web-test
    # added domain due to ssl support not working on default domain
    domain: dev.dev.east.paas.geointservices.io
    buildpack: staticfile_buildpack
    memory: 64M
    instances: 1
    path: ./web/public
  - name: efc-test
    # added domain due to ssl support not working on default domain
    domain: dev.dev.east.paas.geointservices.io
    buildpack: java_buildpack_offline
    memory: 2G
    instances: 1
    path: ./server/target/spacon-server.jar
    env:
      ALLOWED_ORIGINS: https://efc-web-test.dev.dev.east.paas.geointservices.io
      AUTO_MIGRATE: true
      ENV: DEV
      KEY_STORE: /app/server/tls/test-keystore.p12
      MQTT_CLIENT_ID: spacon-server-devio
      TRUST_STORE: /app/server/tls/test-cacerts.jks
    services:
      - efc-db-test
      - efc-mqtt-test
